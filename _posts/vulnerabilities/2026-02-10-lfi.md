---
title: 游늭 LFI
categories: [Vulnerabilidades]
tags: [lfi]
image: "/assets/img/lfi.png"
description: "Local File Inclusion attack"
---

# 游늭 **Local File Inclusion (LFI)**

Explicaci칩n acerca del Local File Inclusion (LFI)

<div style="text-align: center;">
  <img src="{{ site.baseurl }}/assets/img/lfi.png" width="300"/>
  <p style="font-style: italic; margin-top: 8x;">Copyright 춸 2010-2025 Freepik Company S.L.</p>
</div>

# 游눠**쯈u칠 es el LFI?**

**Local File Inclusion (LFI)** es una vulnerabilidad en la que un atacante logra incluir archivos locales del servidor dentro de la aplicaci칩n web.  

Normalmente ocurre cuando el servidor construye rutas de archivos bas치ndose en entradas proporcionadas por el usuario sin realizar la validaci칩n adecuada.

---

# 游빍**Laboratorios**

En caso de que quer치is ver la resoluci칩n directa de alg칰n laboratorio, pod칠is utilizar el siguiente 칤ndice:

- [Lab 1](#lab-1): File path traversal, simple case
- [Lab 2](#lab-2): File path traversal, traversal sequences blocked with absolute path bypass
- [Lab 3](#lab-3): File path traversal, traversal sequences stripped non-recursively
- [Lab 4](#lab-4): File path traversal, traversal sequences stripped with superfluous URL-decode
- [Lab 5](#lab-5): File path traversal, validation of start of path
- [Lab 6](#lab-6): File path traversal, validation of file extension with null byte bypass

---

Dado el **LFI** no se clasifica estrictamente en grupos, sino m치s bien en diferentes formas de enfoque, abordaremos la resoluci칩n de los laboratorios de manera progresiva.

---

# Lab 1

**LFI caso sencillo**

Para todos los laboratorios, utilizaremos una vulnerabilidad presente en la ruta de las im치genes que se encuentran dentro de los posts.  

Si abrimos una imagen en una nueva pesta침a e interceptamos la solicitud con BurpSuite, se observa la siguiente ruta:  
```bash
https://0a7c002504a034be80ee26c900c400cf.web-security-academy.net/image?filename=53.jpg
```


En este caso, nos llama la atenci칩n el par치metro `filename`.  

Aplicaremos la t칠cnica m치s b치sica, que consiste en realizar un **directory path traversal**, es decir, retroceder directorios hasta acceder al archivo `/etc/passwd`. Todo esto se realiza de la siguiente manera:

<div style="text-align: center;">
  <img src="{{ site.baseurl }}/assets/lfi/lfi-1.png" width="1000"/>
</div>

---

# Lab 2

**LFI con secuencias de recorrido bloqueadas con omisi칩n de ruta absoluta**

Una vez m치s, contamos con la ruta del laboratorio anterior y el par치metro `filename`.  

Sin embargo, para resolver este laboratorio, en lugar de realizar un directory path traversal, utilizaremos la ruta absoluta al archivo `/etc/passwd`.
```bash
https://0a7c002504a034be80ee26c900c400cf.web-security-academy.net/image?filename=/etc/passwd
```

---

# Lab 3

**LFI con secuencias de recorrido eliminadas de forma no recursiva**

Una vez m치s, contamos con la ruta del laboratorio anterior y el par치metro `filename`.

Sin embargo, al intentar aplicar los m칠todos de los laboratorios anteriores, comprobamos que no funcionan.  

Existen diferentes tipos de sanitizaci칩n que impiden la inclusi칩n de cadenas como `../../../` y las eliminan. No obstante, si utilizamos una cadena como `....//....//....//`, puede ocurrir que el sistema elimine 칰nicamente el primer `../` de cada bloque `....//`, dejando un `../` restante.  

En el payload, esto se ver칤a de la siguiente manera:
```bash
https://0a7c002504a034be80ee26c900c400cf.web-security-academy.net/image?filename=....//....//....//....//etc/passwd
```

---

# Lab 4

**LFI con secuencias de recorrido eliminadas con decodificaci칩n URL superflua**

Una vez m치s, contamos con la ruta del laboratorio anterior y el par치metro `filename`.

Sin embargo, al intentar aplicar los m칠todos de los laboratorios anteriores, comprobamos que no funcionan.

Al igual que hemos hecho en otros laboratorios con diferentes vulnerabilidades, podemos **url-encodear** ciertos caracteres especiales para evadir los mecanismos de validaci칩n del programa.  

En este caso, podemos probar a url-encodear la barra `/` y, a su vez, el car치cter `%` resultante de este url-encode.
```bash
GET /image?filename=..%252f..%252f..%252f..%252f..%252fetc/passwd
```

<div style="text-align: center;">
  <img src="{{ site.baseurl }}/assets/lfi/lfi-2.png" width="1000"/>
</div>

---

# Lab 5

**LFI con validaci칩n del inicio de la ruta**

Una vez m치s, contamos con la ruta del laboratorio anterior y el par치metro `filename`.

Sin embargo, al intentar aplicar los m칠todos de los laboratorios anteriores, comprobamos que no funcionan.

Adem치s, se puede observar en la URL que no partimos desde la ra칤z ni desde un directorio oculto, sino que la imagen se est치 buscando en `/var/www/images`.  

Sin embargo, esto no garantiza nada, ya que todav칤a podemos utilizar `../../../` para acceder al archivo `/etc/passwd`.  

Esto se realizar칤a de la siguiente manera:
```bash
GET /image?filename=/var/www/images/../../../../../../etc/passwd HTTP/2
```

---

# Lab 6

**LFI con validaci칩n de extensiones de archivos con omisi칩n de bytes nulos**

Una vez m치s, contamos con la ruta del laboratorio anterior y el par치metro `filename`.

Sin embargo, al intentar aplicar los m칠todos de los laboratorios anteriores, comprobamos que no funcionan.

Para resolver este laboratorio, vamos a trabajar con un concepto interesante llamado **`null byte`**.  

Este se utiliza en ocasiones para enga침ar a los programas de validaci칩n, especialmente aquellos que verifican la extensi칩n de un archivo. Por ejemplo, si enviamos la cadena `/etc/passwd%00.jpg`, el programa de validaci칩n detecta que la extensi칩n `.jpg` est치 presente y permite la solicitud.  

Sin embargo, al ser interpretada por el servidor, el **null byte** (`%00`) indica el final de la cadena, por lo que todo lo que est칠 detr치s se ignora. Es decir, para la validaci칩n el archivo parece un `.jpg`, pero el servidor procesa 칰nicamente `/etc/passwd`.  

Todo esto se representar칤a de la siguiente manera:
```bash
GET /image?filename=../../../../../../../etc/passwd%00.jpg HTTP/2
```

<div style="text-align: center;">
  <img src="{{ site.baseurl }}/assets/lfi/lfi-3.png" width="1000"/>
</div>
